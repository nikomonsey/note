## 事务

事务 ：一组逻辑操作单元，数据从一种状态到另一种状态

什么是事务	**在一次和mysql的连接当中，所有的sql语句，要么一起成功，要么一起失败**

事务用于保证数据的一致性,它由一组相关的dml语句组成,

该组的dml语句要么全部成功，要么全部失败。如:转账就要用事务来处理，用以保证数据的一致性。

mysql数据库控制台事务的几个重要操作(基本操作 transaction.sql)

1.start transaction 		--开始一个事务/		set autocommit=off

2.savepoint					保存点名--设置保存点

3.rollback to				  保存点名--回退事务到保存点

4.rollback 					--回退全部事务，回到开始事务的时候

5.commit					--提交事务,所有的操作生效,不能回退

#### 注意

1. 提交事务会删除事务所有的保存点，其他连接（会话）才能看到新数据
2. 当回退到一个保存点 会删除中间所有的保存点
3.	若不开启事务，dml操作会自动提交，不能回滚
4.	InnoDB 存储引擎支持事务，MyIsAM不支持





### 事务的ACID特性

原子性(Atomicity)：原子意为最小的粒子，或者说不能再分的事物。数据库事务的不可再分的原则即为原子性。

​		组成事务的所有查询必须：要么全部执行，要么全部取消

一致性(Consistency)：指数据的规则,在事务前/后应保持一致

隔离性(Isolation)：简单点说，某个事务的操作对其他事务不可见的.

持久性(Durability)：当事务提交完成后，其影响应该保留下来，不能撤消







### 事务隔离级别

定义了事务与事务之间的隔离程度。

多个连接开启各自事务操作数据库中数据时，数据库系统要负责隔离操作，以保证各个连接在获取数据时的准确性。(通俗解释)

脏读(dirty read):当一个事务读取另一个事务尚未提交的改变(update,insert,delete)时，产生脏读

不可重复读(nonrepeatable read):同一查询在同一事务中多次进行，由于其他提交事务所做的修改或删除，每次返回不同的结果集，此时发生不可重复读。

幻读(phantom read):同一查询在同一事务中多次进行，由于其他提交事务所做的插入操作，每次返回不同的结果集，此时发生幻读。

| Mysql隔离级别              | 脏读 | 不可重复读 | 幻读 | 加锁读 |
| -------------------------- | ---- | ---------- | ---- | ------ |
| 读未提交(Read uncommitted) | √    | √          | √    | 不加锁 |
| 读已提交(Read  committed)  | ×    | √          | √    | 不加锁 |
| 可重复读(Repeatable read)  | ×    | ×          | ×    | 不加锁 |
| 可串行化(Serializable)     | ×    | ×          | ×    | 加锁   |

√	可能出现	×	不会出现

1.查看当前会话隔离级别

select @@tx_isolation;

2.查看系统当前隔离级别
select @@global.tx_isolation;

3.设置当前会话隔离级别
set session transaction isolation level repeatable read;

4.设置系统当前隔离级别

set global transaction isolation level repeatable read;

5.mysql默认的事务隔离级别是repeatable read，一般情况下，没有特殊
要求，没有必要修改(因为该级别可以满足绝大部分项目需求)